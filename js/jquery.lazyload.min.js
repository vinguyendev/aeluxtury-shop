$(document).ready(function(){

	$(window).scroll(function(){
		var top = $(this).scrollTop()
		LAZYLOAD.start(top);
	});
	LAZYLOAD.init();
});

var LAZYLOAD = {
	init:function(){

		$('img.lazy').each(function(){
			$(this).css({opacity:0});
			/* $(this).attr('src','/publics/theme/mobile/images/loading.gif');*/
		});
		LAZYLOAD.start(0);
		setTimeout(function(){LAZYLOAD.start(0);},1000);
	},
	show:function(item){
		item.addClass('lazyloaded')
		var src =item.attr('data-original');
		var tagname = item.prop("tagName");
		console.log(tagname);
		if(tagname=='img'||tagname=='IMG'){
			item.attr('src',src);
		}else{
			if(src){
				item.css({background:'url('+src+')'});
			}
		}
		item.animate({
			opacity: 1,
		}, 1, function() {

			/*product_lib.reloadLayout();*/
			 item.css({opacity:''});
		});
	},
	start:function(top){
		$('.lazy').each(function(){
			var item_top = $(this).offset().top-$(window).height()-2000;

			if(top>item_top && !$(this).hasClass('lazyloaded')){
				LAZYLOAD.show($(this));
			}
		});
	}
}